<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="local-6989586621679428837"><span id="local-6989586621679428838"></span></span><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hydra.Tx.Contract.Decrement</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Cardano.Api</span></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-keyword">label</span></span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.Hydra.Tx.Mutation</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-8"></span><span>  </span><span class="annot"><span class="hs-identifier">Mutation</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>  </span><span class="annot"><span class="hs-identifier">SomeMutation</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>  </span><span class="annot"><span class="hs-identifier">addParticipationTokens</span></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>  </span><span class="annot"><span class="hs-identifier">modifyInlineDatum</span></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>  </span><span class="annot"><span class="hs-identifier">replaceParties</span></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>  </span><span class="annot"><span class="hs-identifier">replaceSnapshotVersion</span></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api.UTxO</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UTxO</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier">fromJust</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ToErrorCode</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.HeadError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HeadError</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.HeadState</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Head</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Data.Party</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OnChain</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Plutus.Orphans</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.ContestationPeriod</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ContestationPeriod</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toChain</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Tx.Contract.CollectCom.html"><span class="hs-identifier">Hydra.Tx.Contract.CollectCom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Tx.Contract.CollectCom.html#extractHeadOutputValue"><span class="hs-identifier">extractHeadOutputValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.Crypto</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HydraKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MultiSignature</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">aggregate</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sign</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toPlutusSignatures</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.Decrement</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><span class="hs-identifier">decrementTx</span></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.HeadId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mkHeadId</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.HeadParameters</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HeadParameters</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.Init</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mkHeadOutput</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.IsTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IsTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hashUTxO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">withoutUTxO</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.Party</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Party</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">deriveParty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">partyToChain</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.ScriptRegistry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">registryUTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.Snapshot</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Snapshot</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SnapshotNumber</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SnapshotVersion</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.Utils</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">adaOnly</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">splitUTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx.Builtins</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toBuiltin</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.Hydra.Tx.Fixture</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">aliceSk</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">bobSk</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">carolSk</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">testNetworkId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">testPolicyId</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.Hydra.Tx.Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">genForParty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">genScriptRegistry</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">genUTxOSized</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">genValue</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">genVerificationKey</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">arbitrarySizedNatural</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">choose</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">elements</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">oneof</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck.Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">suchThat</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck.Instances</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#healthyDecrementTx"><span class="hs-identifier hs-type">healthyDecrementTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span id="healthyDecrementTx"><span class="annot"><span class="annottext">healthyDecrementTx :: (Tx, UTxO Era)
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyDecrementTx"><span class="hs-identifier hs-var hs-var">healthyDecrementTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679429063"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTxO Era
</span><a href="#local-6989586621679429064"><span class="hs-identifier hs-var">lookupUTxO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-48"></span><span>  </span><span id="local-6989586621679429064"><span class="annot"><span class="annottext">lookupUTxO :: UTxO Era
</span><a href="#local-6989586621679429064"><span class="hs-identifier hs-var hs-var">lookupUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="annottext">TxIn -&gt; TxOut CtxUTxO Era -&gt; UTxO Era
forall era. TxIn -&gt; TxOut CtxUTxO era -&gt; UTxO era
</span><span class="hs-identifier hs-var">UTxO.singleton</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679429066"><span class="hs-identifier hs-var">headInput</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO Era
</span><a href="#local-6989586621679429067"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-50"></span><span>      </span><span class="annot"><span class="annottext">UTxO Era -&gt; UTxO Era -&gt; UTxO Era
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry -&gt; UTxO Era
</span><span class="hs-identifier hs-var">registryUTxO</span></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621679429068"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span>  </span><span id="local-6989586621679429063"><span class="annot"><span class="annottext">tx :: Tx
</span><a href="#local-6989586621679429063"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><span class="annottext">ScriptRegistry
-&gt; VerificationKey PaymentKey
-&gt; HeadId
-&gt; HeadParameters
-&gt; (TxIn, TxOut CtxUTxO Era)
-&gt; Snapshot Tx
-&gt; MultiSignature (Snapshot Tx)
-&gt; Tx
</span><span class="hs-identifier hs-var">decrementTx</span></span><span>
</span><span id="line-54"></span><span>      </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621679429068"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span>
</span><span id="line-55"></span><span>      </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="Hydra.Tx.Contract.Decrement.html#somePartyCardanoVerificationKey"><span class="hs-identifier hs-var">somePartyCardanoVerificationKey</span></a></span><span>
</span><span id="line-56"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; HeadId
</span><span class="hs-identifier hs-var">mkHeadId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><span class="hs-identifier hs-var">testPolicyId</span></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>      </span><span class="annot"><span class="annottext">HeadParameters
</span><a href="#local-6989586621679429070"><span class="hs-identifier hs-var">parameters</span></a></span><span>
</span><span id="line-58"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679429066"><span class="hs-identifier hs-var">headInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO Era
</span><a href="#local-6989586621679429067"><span class="hs-identifier hs-var">headOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>      </span><span class="annot"><span class="annottext">Snapshot Tx
</span><a href="Hydra.Tx.Contract.Decrement.html#healthySnapshot"><span class="hs-identifier hs-var">healthySnapshot</span></a></span><span>
</span><span id="line-60"></span><span>      </span><span class="annot"><span class="annottext">MultiSignature (Snapshot Tx)
</span><a href="Hydra.Tx.Contract.Decrement.html#healthySignature"><span class="hs-identifier hs-var">healthySignature</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span>  </span><span id="local-6989586621679429070"><span class="annot"><span class="annottext">parameters :: HeadParameters
</span><a href="#local-6989586621679429070"><span class="hs-identifier hs-var hs-var">parameters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HeadParameters</span></span><span>
</span><span id="line-64"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:parties:HeadParameters :: [Party]
</span><span class="hs-identifier hs-var">parties</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyParties"><span class="hs-identifier hs-var">healthyParties</span></a></span><span>
</span><span id="line-65"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contestationPeriod:HeadParameters :: ContestationPeriod
</span><span class="hs-identifier hs-var">contestationPeriod</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyContestationPeriod"><span class="hs-identifier hs-var">healthyContestationPeriod</span></a></span><span>
</span><span id="line-66"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span>  </span><span id="local-6989586621679429068"><span class="annot"><span class="annottext">scriptRegistry :: ScriptRegistry
</span><a href="#local-6989586621679429068"><span class="hs-identifier hs-var hs-var">scriptRegistry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Gen ScriptRegistry
</span><span class="hs-identifier hs-var">genScriptRegistry</span></span><span> </span><span class="annot"><span class="annottext">Gen ScriptRegistry -&gt; Int -&gt; ScriptRegistry
forall a. Gen a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`generateWith`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">42</span></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span>  </span><span id="local-6989586621679429066"><span class="annot"><span class="annottext">headInput :: TxIn
</span><a href="#local-6989586621679429066"><span class="hs-identifier hs-var hs-var">headInput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Gen TxIn -&gt; Int -&gt; TxIn
forall a. Gen a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">generateWith</span></span><span> </span><span class="annot"><span class="annottext">Gen TxIn
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">42</span></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span>  </span><span id="local-6989586621679429067"><span class="annot"><span class="annottext">headOutput :: TxOut CtxUTxO Era
</span><a href="#local-6989586621679429067"><span class="hs-identifier hs-var hs-var">headOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><span class="annottext">NetworkId -&gt; PolicyId -&gt; TxOutDatum CtxUTxO -&gt; TxOut CtxUTxO Era
forall ctx. NetworkId -&gt; PolicyId -&gt; TxOutDatum ctx -&gt; TxOut ctx
</span><span class="hs-identifier hs-var">mkHeadOutput</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">testNetworkId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><span class="hs-identifier hs-var">testPolicyId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State -&gt; TxOutDatum CtxUTxO
forall era a ctx.
(ToScriptData a, IsBabbageBasedEra era) =&gt;
a -&gt; TxOutDatum ctx era
</span><span class="hs-identifier hs-var">mkTxOutDatumInline</span></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyDatum"><span class="hs-identifier hs-var">healthyDatum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>      </span><span class="annot"><span class="annottext">TxOut CtxUTxO Era
-&gt; (TxOut CtxUTxO Era -&gt; TxOut CtxUTxO Era) -&gt; TxOut CtxUTxO Era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[VerificationKey PaymentKey]
-&gt; TxOut CtxUTxO Era -&gt; TxOut CtxUTxO Era
</span><span class="hs-identifier hs-var">addParticipationTokens</span></span><span> </span><span class="annot"><span class="annottext">[VerificationKey PaymentKey]
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyParticipants"><span class="hs-identifier hs-var">healthyParticipants</span></a></span><span>
</span><span id="line-75"></span><span>      </span><span class="annot"><span class="annottext">TxOut CtxUTxO Era
-&gt; (TxOut CtxUTxO Era -&gt; TxOut CtxUTxO Era) -&gt; TxOut CtxUTxO Era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Value) -&gt; TxOut CtxUTxO Era -&gt; TxOut CtxUTxO Era
forall era ctx.
IsMaryBasedEra era =&gt;
(Value -&gt; Value) -&gt; TxOut ctx era -&gt; TxOut ctx era
</span><span class="hs-identifier hs-var">modifyTxOutValue</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO Era -&gt; Value
forall era. UTxO era -&gt; Value
</span><span class="hs-identifier hs-var">UTxO.totalValue</span></span><span> </span><span class="annot"><span class="annottext">UTxO Era
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyUTxO"><span class="hs-identifier hs-var">healthyUTxO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#somePartyCardanoVerificationKey"><span class="hs-identifier hs-type">somePartyCardanoVerificationKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span>
</span><span id="line-78"></span><span id="somePartyCardanoVerificationKey"><span class="annot"><span class="annottext">somePartyCardanoVerificationKey :: VerificationKey PaymentKey
</span><a href="Hydra.Tx.Contract.Decrement.html#somePartyCardanoVerificationKey"><span class="hs-identifier hs-var hs-var">somePartyCardanoVerificationKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><span class="annottext">[VerificationKey PaymentKey] -&gt; Gen (VerificationKey PaymentKey)
forall a. HasCallStack =&gt; [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="annot"><span class="annottext">[VerificationKey PaymentKey]
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyParticipants"><span class="hs-identifier hs-var">healthyParticipants</span></a></span><span> </span><span class="annot"><span class="annottext">Gen (VerificationKey PaymentKey)
-&gt; Int -&gt; VerificationKey PaymentKey
forall a. Gen a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`generateWith`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">42</span></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#healthySigningKeys"><span class="hs-identifier hs-type">healthySigningKeys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">SigningKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HydraKey</span></span><span class="hs-special">]</span><span>
</span><span id="line-82"></span><span id="healthySigningKeys"><span class="annot"><span class="annottext">healthySigningKeys :: [SigningKey HydraKey]
</span><a href="Hydra.Tx.Contract.Decrement.html#healthySigningKeys"><span class="hs-identifier hs-var hs-var">healthySigningKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><span class="hs-identifier hs-var">aliceSk</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><span class="hs-identifier hs-var">bobSk</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><span class="hs-identifier hs-var">carolSk</span></span><span class="hs-special">]</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#healthyParticipants"><span class="hs-identifier hs-type">healthyParticipants</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span class="hs-special">]</span><span>
</span><span id="line-85"></span><span id="healthyParticipants"><span class="annot"><span class="annottext">healthyParticipants :: [VerificationKey PaymentKey]
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyParticipants"><span class="hs-identifier hs-var hs-var">healthyParticipants</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><span class="annottext">Gen (VerificationKey PaymentKey)
-&gt; Party -&gt; VerificationKey PaymentKey
forall a. Gen a -&gt; Party -&gt; a
</span><span class="hs-identifier hs-var">genForParty</span></span><span> </span><span class="annot"><span class="annottext">Gen (VerificationKey PaymentKey)
</span><span class="hs-identifier hs-var">genVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">(Party -&gt; VerificationKey PaymentKey)
-&gt; [Party] -&gt; [VerificationKey PaymentKey]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyParties"><span class="hs-identifier hs-var">healthyParties</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#healthyParties"><span class="hs-identifier hs-type">healthyParties</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span class="hs-special">]</span><span>
</span><span id="line-89"></span><span id="healthyParties"><span class="annot"><span class="annottext">healthyParties :: [Party]
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyParties"><span class="hs-identifier hs-var hs-var">healthyParties</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey -&gt; Party) -&gt; [SigningKey HydraKey] -&gt; [Party]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SigningKey HydraKey]
</span><a href="Hydra.Tx.Contract.Decrement.html#healthySigningKeys"><span class="hs-identifier hs-var">healthySigningKeys</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#healthyOnChainParties"><span class="hs-identifier hs-type">healthyOnChainParties</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">OnChain.Party</span></span><span class="hs-special">]</span><span>
</span><span id="line-92"></span><span id="healthyOnChainParties"><span class="annot"><span class="annottext">healthyOnChainParties :: [Party]
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyOnChainParties"><span class="hs-identifier hs-var hs-var">healthyOnChainParties</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Party -&gt; Party
</span><span class="hs-identifier hs-var">partyToChain</span></span><span> </span><span class="annot"><span class="annottext">(Party -&gt; Party) -&gt; [Party] -&gt; [Party]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyParties"><span class="hs-identifier hs-var">healthyParties</span></a></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#healthySignature"><span class="hs-identifier hs-type">healthySignature</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MultiSignature</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Snapshot</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span id="healthySignature"><span class="annot"><span class="annottext">healthySignature :: MultiSignature (Snapshot Tx)
</span><a href="Hydra.Tx.Contract.Decrement.html#healthySignature"><span class="hs-identifier hs-var hs-var">healthySignature</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Signature (Snapshot Tx)] -&gt; MultiSignature (Snapshot Tx)
forall {k} (a :: k). [Signature a] -&gt; MultiSignature a
</span><span class="hs-identifier hs-var">aggregate</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Snapshot Tx -&gt; Signature (Snapshot Tx)
forall a.
SignableRepresentation a =&gt;
SigningKey HydraKey -&gt; a -&gt; Signature a
</span><span class="hs-identifier hs-var">sign</span></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679429098"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="annot"><span class="annottext">Snapshot Tx
</span><a href="Hydra.Tx.Contract.Decrement.html#healthySnapshot"><span class="hs-identifier hs-var">healthySnapshot</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679429098"><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679429098"><span class="hs-identifier hs-var">sk</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SigningKey HydraKey]
</span><a href="Hydra.Tx.Contract.Decrement.html#healthySigningKeys"><span class="hs-identifier hs-var">healthySigningKeys</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#healthySnapshotNumber"><span class="hs-identifier hs-type">healthySnapshotNumber</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SnapshotNumber</span></span><span>
</span><span id="line-98"></span><span id="healthySnapshotNumber"><span class="annot"><span class="annottext">healthySnapshotNumber :: SnapshotNumber
</span><a href="Hydra.Tx.Contract.Decrement.html#healthySnapshotNumber"><span class="hs-identifier hs-var hs-var">healthySnapshotNumber</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><span class="hs-number">1</span></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#healthySnapshotVersion"><span class="hs-identifier hs-type">healthySnapshotVersion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SnapshotVersion</span></span><span>
</span><span id="line-101"></span><span id="healthySnapshotVersion"><span class="annot"><span class="annottext">healthySnapshotVersion :: SnapshotVersion
</span><a href="Hydra.Tx.Contract.Decrement.html#healthySnapshotVersion"><span class="hs-identifier hs-var hs-var">healthySnapshotVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapshotVersion
</span><span class="hs-number">1</span></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#healthySnapshot"><span class="hs-identifier hs-type">healthySnapshot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Snapshot</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-104"></span><span id="healthySnapshot"><span class="annot"><span class="annottext">healthySnapshot :: Snapshot Tx
</span><a href="Hydra.Tx.Contract.Decrement.html#healthySnapshot"><span class="hs-identifier hs-var hs-var">healthySnapshot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679429101"><span class="annot"><span class="annottext">UTxO Era
</span><a href="#local-6989586621679429101"><span class="hs-identifier hs-var">utxoToDecommit'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679429102"><span class="annot"><span class="annottext">UTxO Era
</span><a href="#local-6989586621679429102"><span class="hs-identifier hs-var">utxo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO Era -&gt; (UTxO Era, UTxO Era)
</span><span class="hs-identifier hs-var">splitUTxO</span></span><span> </span><span class="annot"><span class="annottext">UTxO Era
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyUTxO"><span class="hs-identifier hs-var">healthyUTxO</span></a></span><span>
</span><span id="line-106"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Snapshot</span></span><span>
</span><span id="line-107"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:headId:Snapshot :: HeadId
</span><span class="hs-identifier hs-var">headId</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; HeadId
</span><span class="hs-identifier hs-var">mkHeadId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><span class="hs-identifier hs-var">testPolicyId</span></span><span>
</span><span id="line-108"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:version:Snapshot :: SnapshotVersion
</span><span class="hs-identifier hs-var">version</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapshotVersion
</span><a href="Hydra.Tx.Contract.Decrement.html#healthySnapshotVersion"><span class="hs-identifier hs-var">healthySnapshotVersion</span></a></span><span>
</span><span id="line-109"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:number:Snapshot :: SnapshotNumber
</span><span class="hs-identifier hs-var">number</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapshotNumber -&gt; SnapshotNumber
forall a. Enum a =&gt; a -&gt; a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Enum.html#succ"><span class="hs-identifier hs-var">succ</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="Hydra.Tx.Contract.Decrement.html#healthySnapshotNumber"><span class="hs-identifier hs-var">healthySnapshotNumber</span></a></span><span>
</span><span id="line-110"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:confirmed:Snapshot :: [Tx]
</span><span class="hs-identifier hs-var">confirmed</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-111"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTxO Era
UTxOType Tx
utxo :: UTxO Era
$sel:utxo:Snapshot :: UTxOType Tx
</span><a href="#local-6989586621679429102"><span class="hs-identifier hs-var hs-var">utxo</span></a></span><span>
</span><span id="line-112"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoToCommit:Snapshot :: Maybe (UTxOType Tx)
</span><span class="hs-identifier hs-var">utxoToCommit</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (UTxO Era)
Maybe (UTxOType Tx)
forall a. Maybe a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-113"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoToDecommit:Snapshot :: Maybe (UTxOType Tx)
</span><span class="hs-identifier hs-var">utxoToDecommit</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO Era -&gt; Maybe (UTxO Era)
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO Era
</span><a href="#local-6989586621679429101"><span class="hs-identifier hs-var">utxoToDecommit'</span></a></span><span>
</span><span id="line-114"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#splitDecommitUTxO"><span class="hs-identifier hs-type">splitDecommitUTxO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span id="splitDecommitUTxO"><span class="annot"><span class="annottext">splitDecommitUTxO :: UTxO Era -&gt; (UTxO Era, UTxO Era)
</span><a href="Hydra.Tx.Contract.Decrement.html#splitDecommitUTxO"><span class="hs-identifier hs-var hs-var">splitDecommitUTxO</span></a></span></span><span> </span><span id="local-6989586621679429113"><span class="annot"><span class="annottext">UTxO Era
</span><a href="#local-6989586621679429113"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UTxO Era -&gt; [(TxIn, TxOut CtxUTxO Era)]
forall era. UTxO era -&gt; [(TxIn, TxOut CtxUTxO era)]
</span><span class="hs-identifier hs-var">UTxO.toList</span></span><span> </span><span class="annot"><span class="annottext">UTxO Era
</span><a href="#local-6989586621679429113"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (UTxO Era, UTxO Era)
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;empty utxo in splitDecommitUTxO&quot;</span></span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679429116"><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era)
</span><a href="#local-6989586621679429116"><span class="hs-identifier hs-var">decommit</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679429117"><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO Era)]
</span><a href="#local-6989586621679429117"><span class="hs-identifier hs-var">_rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-121"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679429118"><span class="annot"><span class="annottext">decommitUTxO' :: UTxO Era
</span><a href="#local-6989586621679429118"><span class="hs-identifier hs-var hs-var">decommitUTxO'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO Era)] -&gt; UTxO Era
forall era. [(TxIn, TxOut CtxUTxO era)] -&gt; UTxO era
</span><span class="hs-identifier hs-var">UTxO.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era)
</span><a href="#local-6989586621679429116"><span class="hs-identifier hs-var">decommit</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-122"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxO Era
UTxOType Tx
</span><a href="#local-6989586621679429113"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOType Tx -&gt; UTxOType Tx -&gt; UTxOType Tx
forall tx. IsTx tx =&gt; UTxOType tx -&gt; UTxOType tx -&gt; UTxOType tx
</span><span class="hs-operator hs-var">`withoutUTxO`</span></span><span> </span><span class="annot"><span class="annottext">UTxO Era
UTxOType Tx
</span><a href="#local-6989586621679429118"><span class="hs-identifier hs-var">decommitUTxO'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTxO Era
</span><a href="#local-6989586621679429118"><span class="hs-identifier hs-var">decommitUTxO'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#healthyContestationPeriod"><span class="hs-identifier hs-type">healthyContestationPeriod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ContestationPeriod</span></span><span>
</span><span id="line-125"></span><span id="healthyContestationPeriod"><span class="annot"><span class="annottext">healthyContestationPeriod :: ContestationPeriod
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyContestationPeriod"><span class="hs-identifier hs-var hs-var">healthyContestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><span class="annottext">Gen ContestationPeriod
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span> </span><span class="annot"><span class="annottext">Gen ContestationPeriod -&gt; Int -&gt; ContestationPeriod
forall a. Gen a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`generateWith`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">42</span></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#healthyUTxO"><span class="hs-identifier hs-type">healthyUTxO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span>
</span><span id="line-129"></span><span id="healthyUTxO"><span class="annot"><span class="annottext">healthyUTxO :: UTxO Era
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyUTxO"><span class="hs-identifier hs-var hs-var">healthyUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO Era -&gt; TxOut CtxUTxO Era) -&gt; UTxO Era -&gt; UTxO Era
forall era.
(TxOut CtxUTxO era -&gt; TxOut CtxUTxO era) -&gt; UTxO era -&gt; UTxO era
</span><span class="hs-identifier hs-var">UTxO.map</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO Era -&gt; TxOut CtxUTxO Era
</span><span class="hs-identifier hs-var">adaOnly</span></span><span> </span><span class="annot"><span class="annottext">(UTxO Era -&gt; UTxO Era) -&gt; UTxO Era -&gt; UTxO Era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Gen (UTxO Era) -&gt; Int -&gt; UTxO Era
forall a. Gen a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">generateWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Gen (UTxO Era)
</span><span class="hs-identifier hs-var">genUTxOSized</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">42</span></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#healthyDatum"><span class="hs-identifier hs-type">healthyDatum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.State</span></span><span>
</span><span id="line-132"></span><span id="healthyDatum"><span class="annot"><span class="annottext">healthyDatum :: State
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyDatum"><span class="hs-identifier hs-var hs-var">healthyDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679429121"><span class="annot"><span class="annottext">UTxO Era
</span><a href="#local-6989586621679429121"><span class="hs-identifier hs-var">_utxoToDecommit'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679429122"><span class="annot"><span class="annottext">UTxO Era
</span><a href="#local-6989586621679429122"><span class="hs-identifier hs-var">utxo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO Era -&gt; (UTxO Era, UTxO Era)
</span><a href="Hydra.Tx.Contract.Decrement.html#splitDecommitUTxO"><span class="hs-identifier hs-var">splitDecommitUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO Era
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyUTxO"><span class="hs-identifier hs-var">healthyUTxO</span></a></span><span>
</span><span id="line-134"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">OpenDatum -&gt; State
</span><span class="hs-identifier hs-var">Head.Open</span></span><span>
</span><span id="line-135"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Head.OpenDatum</span></span><span>
</span><span id="line-136"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:utxoHash:OpenDatum :: Hash
</span><span class="hs-identifier hs-var">utxoHash</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ToBuiltin ByteString
forall a. HasToBuiltin a =&gt; a -&gt; ToBuiltin a
</span><span class="hs-identifier hs-var">toBuiltin</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ToBuiltin ByteString)
-&gt; ByteString -&gt; ToBuiltin ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tx. IsTx tx =&gt; UTxOType tx -&gt; ByteString
</span><span class="hs-identifier hs-var">hashUTxO</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="annot"><span class="annottext">UTxO Era
UTxOType Tx
</span><a href="#local-6989586621679429122"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-137"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:parties:OpenDatum :: [Party]
</span><span class="hs-identifier hs-var">parties</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyOnChainParties"><span class="hs-identifier hs-var">healthyOnChainParties</span></a></span><span>
</span><span id="line-138"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contestationPeriod:OpenDatum :: ContestationPeriod
</span><span class="hs-identifier hs-var">contestationPeriod</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod -&gt; ContestationPeriod
</span><span class="hs-identifier hs-var">toChain</span></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyContestationPeriod"><span class="hs-identifier hs-var">healthyContestationPeriod</span></a></span><span>
</span><span id="line-139"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:headId:OpenDatum :: CurrencySymbol
</span><span class="hs-identifier hs-var">headId</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; CurrencySymbol
</span><span class="hs-identifier hs-var">toPlutusCurrencySymbol</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><span class="hs-identifier hs-var">testPolicyId</span></span><span>
</span><span id="line-140"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:version:OpenDatum :: SnapshotNumber
</span><span class="hs-identifier hs-var">version</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapshotVersion -&gt; SnapshotNumber
forall a. Integral a =&gt; a -&gt; SnapshotNumber
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Real.html#toInteger"><span class="hs-identifier hs-var">toInteger</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotVersion
</span><a href="Hydra.Tx.Contract.Decrement.html#healthySnapshotVersion"><span class="hs-identifier hs-var">healthySnapshotVersion</span></a></span><span>
</span><span id="line-141"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-keyword">data</span><span> </span><span id="DecrementMutation"><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#DecrementMutation"><span class="hs-identifier hs-var">DecrementMutation</span></a></span></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | Ensures parties do not change between head input datum and head output</span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-comment">--  datum.</span><span>
</span><span id="line-146"></span><span>    </span><span id="ChangePartiesInOutput"><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#ChangePartiesInOutput"><span class="hs-identifier hs-var">ChangePartiesInOutput</span></a></span></span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Produce invalid signature by changing signers in the redeemer</span></span><span>
</span><span id="line-148"></span><span>    </span><span id="ProduceInvalidSignatures"><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#ProduceInvalidSignatures"><span class="hs-identifier hs-var">ProduceInvalidSignatures</span></a></span></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Ensures decrement is authenticated by one of the Head members by changing</span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-comment">--  the signer used on the tx to not be one of PTs.</span><span>
</span><span id="line-151"></span><span>    </span><span id="AlterRequiredSigner"><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#AlterRequiredSigner"><span class="hs-identifier hs-var">AlterRequiredSigner</span></a></span></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Mutate the output value to produce different 'UTxO' hash to the one in the signed 'Snapshot'.</span></span><span>
</span><span id="line-153"></span><span>    </span><span id="ChangeDecrementedValue"><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#ChangeDecrementedValue"><span class="hs-identifier hs-var">ChangeDecrementedValue</span></a></span></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Invalidates the tx by changing the output values arbitrarily to be</span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-comment">-- different (not preserved) from the head.</span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-comment">-- Ensures values are preserved between head input and output.</span><span>
</span><span id="line-158"></span><span>    </span><span id="ChangeHeadValue"><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#ChangeHeadValue"><span class="hs-identifier hs-var">ChangeHeadValue</span></a></span></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Drop one of the decommit outputs from the tx. This should trigger snapshot signature validation to fail.</span></span><span>
</span><span id="line-160"></span><span>    </span><span id="DropDecommitOutput"><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#DropDecommitOutput"><span class="hs-identifier hs-var">DropDecommitOutput</span></a></span></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ExtractSomeValue"><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#ExtractSomeValue"><span class="hs-identifier hs-var">ExtractSomeValue</span></a></span></span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Invalidates the tx by changing the snapshot version in resulting head</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-comment">-- output.</span><span>
</span><span id="line-164"></span><span>    </span><span id="UseDifferentSnapshotVersion"><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#UseDifferentSnapshotVersion"><span class="hs-identifier hs-var">UseDifferentSnapshotVersion</span></a></span></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679429141"><span id="local-6989586621679429143"><span class="annot"><span class="annottext">(forall x. DecrementMutation -&gt; Rep DecrementMutation x)
-&gt; (forall x. Rep DecrementMutation x -&gt; DecrementMutation)
-&gt; Generic DecrementMutation
forall x. Rep DecrementMutation x -&gt; DecrementMutation
forall x. DecrementMutation -&gt; Rep DecrementMutation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. DecrementMutation -&gt; Rep DecrementMutation x
from :: forall x. DecrementMutation -&gt; Rep DecrementMutation x
$cto :: forall x. Rep DecrementMutation x -&gt; DecrementMutation
to :: forall x. Rep DecrementMutation x -&gt; DecrementMutation
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679429147"><span id="local-6989586621679429149"><span id="local-6989586621679429152"><span class="annot"><span class="annottext">Int -&gt; DecrementMutation -&gt; ShowS
[DecrementMutation] -&gt; ShowS
DecrementMutation -&gt; String
(Int -&gt; DecrementMutation -&gt; ShowS)
-&gt; (DecrementMutation -&gt; String)
-&gt; ([DecrementMutation] -&gt; ShowS)
-&gt; Show DecrementMutation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; DecrementMutation -&gt; ShowS
showsPrec :: Int -&gt; DecrementMutation -&gt; ShowS
$cshow :: DecrementMutation -&gt; String
show :: DecrementMutation -&gt; String
$cshowList :: [DecrementMutation] -&gt; ShowS
showList :: [DecrementMutation] -&gt; ShowS
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679429156"><span id="local-6989586621679429163"><span id="local-6989586621679429169"><span id="local-6989586621679429183"><span id="local-6989586621679429185"><span id="local-6989586621679429188"><span id="local-6989586621679429192"><span id="local-6989586621679429195"><span class="annot"><span class="annottext">Int -&gt; DecrementMutation
DecrementMutation -&gt; Int
DecrementMutation -&gt; [DecrementMutation]
DecrementMutation -&gt; DecrementMutation
DecrementMutation -&gt; DecrementMutation -&gt; [DecrementMutation]
DecrementMutation
-&gt; DecrementMutation -&gt; DecrementMutation -&gt; [DecrementMutation]
(DecrementMutation -&gt; DecrementMutation)
-&gt; (DecrementMutation -&gt; DecrementMutation)
-&gt; (Int -&gt; DecrementMutation)
-&gt; (DecrementMutation -&gt; Int)
-&gt; (DecrementMutation -&gt; [DecrementMutation])
-&gt; (DecrementMutation -&gt; DecrementMutation -&gt; [DecrementMutation])
-&gt; (DecrementMutation -&gt; DecrementMutation -&gt; [DecrementMutation])
-&gt; (DecrementMutation
    -&gt; DecrementMutation -&gt; DecrementMutation -&gt; [DecrementMutation])
-&gt; Enum DecrementMutation
forall a.
(a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (Int -&gt; a)
-&gt; (a -&gt; Int)
-&gt; (a -&gt; [a])
-&gt; (a -&gt; a -&gt; [a])
-&gt; (a -&gt; a -&gt; [a])
-&gt; (a -&gt; a -&gt; a -&gt; [a])
-&gt; Enum a
$csucc :: DecrementMutation -&gt; DecrementMutation
succ :: DecrementMutation -&gt; DecrementMutation
$cpred :: DecrementMutation -&gt; DecrementMutation
pred :: DecrementMutation -&gt; DecrementMutation
$ctoEnum :: Int -&gt; DecrementMutation
toEnum :: Int -&gt; DecrementMutation
$cfromEnum :: DecrementMutation -&gt; Int
fromEnum :: DecrementMutation -&gt; Int
$cenumFrom :: DecrementMutation -&gt; [DecrementMutation]
enumFrom :: DecrementMutation -&gt; [DecrementMutation]
$cenumFromThen :: DecrementMutation -&gt; DecrementMutation -&gt; [DecrementMutation]
enumFromThen :: DecrementMutation -&gt; DecrementMutation -&gt; [DecrementMutation]
$cenumFromTo :: DecrementMutation -&gt; DecrementMutation -&gt; [DecrementMutation]
enumFromTo :: DecrementMutation -&gt; DecrementMutation -&gt; [DecrementMutation]
$cenumFromThenTo :: DecrementMutation
-&gt; DecrementMutation -&gt; DecrementMutation -&gt; [DecrementMutation]
enumFromThenTo :: DecrementMutation
-&gt; DecrementMutation -&gt; DecrementMutation -&gt; [DecrementMutation]
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Enum.html#Enum"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Enum</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679429199"><span id="local-6989586621679429201"><span class="annot"><span class="annottext">DecrementMutation
DecrementMutation -&gt; DecrementMutation -&gt; Bounded DecrementMutation
forall a. a -&gt; a -&gt; Bounded a
$cminBound :: DecrementMutation
minBound :: DecrementMutation
$cmaxBound :: DecrementMutation
maxBound :: DecrementMutation
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Enum.html#Bounded"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Bounded</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="annot"><a href="Hydra.Tx.Contract.Decrement.html#genDecrementMutation"><span class="hs-identifier hs-type">genDecrementMutation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeMutation</span></span><span>
</span><span id="line-168"></span><span id="genDecrementMutation"><span class="annot"><span class="annottext">genDecrementMutation :: (Tx, UTxO Era) -&gt; Gen SomeMutation
</span><a href="Hydra.Tx.Contract.Decrement.html#genDecrementMutation"><span class="hs-identifier hs-var hs-var">genDecrementMutation</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679429204"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679429204"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679429205"><span class="annot"><span class="annottext">UTxO Era
</span><a href="#local-6989586621679429205"><span class="hs-identifier hs-var">_utxo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><span class="annottext">[Gen SomeMutation] -&gt; Gen SomeMutation
forall a. HasCallStack =&gt; [Gen a] -&gt; Gen a
</span><span class="hs-identifier hs-var">oneof</span></span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-comment">-- Spec: parameters cid, &#771;kH,n,T stay unchanged</span><span>
</span><span id="line-171"></span><span>      </span><span class="annot"><span class="annottext">[Text] -&gt; DecrementMutation -&gt; Mutation -&gt; SomeMutation
forall lbl.
(Typeable lbl, Enum lbl, Bounded lbl, Show lbl) =&gt;
[Text] -&gt; lbl -&gt; Mutation -&gt; SomeMutation
</span><span class="hs-identifier hs-var">SomeMutation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text]
forall a. a -&gt; [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Text]) -&gt; Text -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HeadError -&gt; Text
forall a. ToErrorCode a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">toErrorCode</span></span><span> </span><span class="annot"><span class="annottext">HeadError
</span><span class="hs-identifier hs-var">ChangedParameters</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DecrementMutation
</span><a href="Hydra.Tx.Contract.Decrement.html#ChangePartiesInOutput"><span class="hs-identifier hs-var">ChangePartiesInOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(Mutation -&gt; SomeMutation) -&gt; Gen Mutation -&gt; Gen SomeMutation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-172"></span><span>        </span><span id="local-6989586621679429209"><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679429209"><span class="hs-identifier hs-var">mutatedParties</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Gen [Party]
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span> </span><span class="annot"><span class="annottext">Gen [Party] -&gt; ([Party] -&gt; Bool) -&gt; Gen [Party]
forall a. Gen a -&gt; (a -&gt; Bool) -&gt; Gen a
</span><span class="hs-operator hs-var">`suchThat`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Party] -&gt; [Party] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="Hydra.Tx.Contract.Decrement.html#healthyOnChainParties"><span class="hs-identifier hs-var">healthyOnChainParties</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>        </span><span class="annot"><span class="annottext">Mutation -&gt; Gen Mutation
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Mutation -&gt; Gen Mutation) -&gt; Mutation -&gt; Gen Mutation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; TxOut CtxTx -&gt; Mutation
</span><span class="hs-identifier hs-var">ChangeOutput</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx -&gt; Mutation) -&gt; TxOut CtxTx -&gt; Mutation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(State -&gt; State) -&gt; TxOut CtxTx -&gt; TxOut CtxTx
forall a.
(FromScriptData a, ToScriptData a) =&gt;
(a -&gt; a) -&gt; TxOut CtxTx -&gt; TxOut CtxTx
</span><span class="hs-identifier hs-var">modifyInlineDatum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Party] -&gt; State -&gt; State
</span><span class="hs-identifier hs-var">replaceParties</span></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679429209"><span class="hs-identifier hs-var">mutatedParties</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679429212"><span class="hs-identifier hs-var">headTxOut</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- New version v&#8242; is incremented correctly</span><span>
</span><span id="line-175"></span><span>      </span><span class="annot"><span class="annottext">[Text] -&gt; DecrementMutation -&gt; Mutation -&gt; SomeMutation
forall lbl.
(Typeable lbl, Enum lbl, Bounded lbl, Show lbl) =&gt;
[Text] -&gt; lbl -&gt; Mutation -&gt; SomeMutation
</span><span class="hs-identifier hs-var">SomeMutation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text]
forall a. a -&gt; [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Text]) -&gt; Text -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HeadError -&gt; Text
forall a. ToErrorCode a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">toErrorCode</span></span><span> </span><span class="annot"><span class="annottext">HeadError
</span><span class="hs-identifier hs-var">VersionNotIncremented</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DecrementMutation
</span><a href="Hydra.Tx.Contract.Decrement.html#UseDifferentSnapshotVersion"><span class="hs-identifier hs-var">UseDifferentSnapshotVersion</span></a></span><span> </span><span class="annot"><span class="annottext">(Mutation -&gt; SomeMutation) -&gt; Gen Mutation -&gt; Gen SomeMutation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-176"></span><span>        </span><span id="local-6989586621679429214"><span class="annot"><span class="annottext">SnapshotVersion
</span><a href="#local-6989586621679429214"><span class="hs-identifier hs-var">mutatedSnapshotVersion</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Gen SnapshotVersion
forall a. Integral a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrarySizedNatural</span></span><span> </span><span class="annot"><span class="annottext">Gen SnapshotVersion
-&gt; (SnapshotVersion -&gt; Bool) -&gt; Gen SnapshotVersion
forall a. Gen a -&gt; (a -&gt; Bool) -&gt; Gen a
</span><span class="hs-operator hs-var">`suchThat`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SnapshotVersion -&gt; SnapshotVersion -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotVersion
</span><a href="Hydra.Tx.Contract.Decrement.html#healthySnapshotVersion"><span class="hs-identifier hs-var">healthySnapshotVersion</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotVersion -&gt; SnapshotVersion -&gt; SnapshotVersion
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotVersion
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>        </span><span class="annot"><span class="annottext">Mutation -&gt; Gen Mutation
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Mutation -&gt; Gen Mutation) -&gt; Mutation -&gt; Gen Mutation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; TxOut CtxTx -&gt; Mutation
</span><span class="hs-identifier hs-var">ChangeOutput</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx -&gt; Mutation) -&gt; TxOut CtxTx -&gt; Mutation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(State -&gt; State) -&gt; TxOut CtxTx -&gt; TxOut CtxTx
forall a.
(FromScriptData a, ToScriptData a) =&gt;
(a -&gt; a) -&gt; TxOut CtxTx -&gt; TxOut CtxTx
</span><span class="hs-identifier hs-var">modifyInlineDatum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SnapshotNumber -&gt; State -&gt; State
</span><span class="hs-identifier hs-var">replaceSnapshotVersion</span></span><span> </span><span class="annot"><span class="annottext">(SnapshotNumber -&gt; State -&gt; State)
-&gt; SnapshotNumber -&gt; State -&gt; State
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotVersion -&gt; SnapshotNumber
forall a. Integral a =&gt; a -&gt; SnapshotNumber
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Real.html#toInteger"><span class="hs-identifier hs-var">toInteger</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotVersion
</span><a href="#local-6989586621679429214"><span class="hs-identifier hs-var">mutatedSnapshotVersion</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679429212"><span class="hs-identifier hs-var">headTxOut</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Spec: &#958; is a valid multi-signature of the currency id cid, the current</span><span>
</span><span id="line-179"></span><span>      </span><span class="hs-comment">-- snapshot state &#951;, the new snapshot number s&#8242; and state &#951;</span><span>
</span><span id="line-180"></span><span>      </span><span class="annot"><span class="annottext">[Text] -&gt; DecrementMutation -&gt; Mutation -&gt; SomeMutation
forall lbl.
(Typeable lbl, Enum lbl, Bounded lbl, Show lbl) =&gt;
[Text] -&gt; lbl -&gt; Mutation -&gt; SomeMutation
</span><span class="hs-identifier hs-var">SomeMutation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text]
forall a. a -&gt; [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Text]) -&gt; Text -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HeadError -&gt; Text
forall a. ToErrorCode a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">toErrorCode</span></span><span> </span><span class="annot"><span class="annottext">HeadError
</span><span class="hs-identifier hs-var">SignatureVerificationFailed</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DecrementMutation
</span><a href="Hydra.Tx.Contract.Decrement.html#ProduceInvalidSignatures"><span class="hs-identifier hs-var">ProduceInvalidSignatures</span></a></span><span> </span><span class="annot"><span class="annottext">(Mutation -&gt; SomeMutation)
-&gt; (Input -&gt; Mutation) -&gt; Input -&gt; SomeMutation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Input -&gt; Mutation
</span><span class="hs-identifier hs-var">ChangeHeadRedeemer</span></span><span> </span><span class="annot"><span class="annottext">(Input -&gt; SomeMutation) -&gt; Gen Input -&gt; Gen SomeMutation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-181"></span><span>        </span><span id="local-6989586621679429219"><span class="annot"><span class="annottext">[Hash]
</span><a href="#local-6989586621679429219"><span class="hs-identifier hs-var">invalidSignature</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MultiSignature (Snapshot Tx) -&gt; [Hash]
forall {k} (a :: k). MultiSignature a -&gt; [Hash]
</span><span class="hs-identifier hs-var">toPlutusSignatures</span></span><span> </span><span class="annot"><span class="annottext">(MultiSignature (Snapshot Tx) -&gt; [Hash])
-&gt; Gen (MultiSignature (Snapshot Tx)) -&gt; Gen [Hash]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Gen (MultiSignature (Snapshot Tx))
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MultiSignature</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Snapshot</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>        </span><span class="annot"><span class="annottext">Input -&gt; Gen Input
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Input -&gt; Gen Input) -&gt; Input -&gt; Gen Input
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-183"></span><span>          </span><span class="annot"><span class="annottext">DecrementRedeemer -&gt; Input
</span><span class="hs-identifier hs-var">Head.Decrement</span></span><span>
</span><span id="line-184"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Head.DecrementRedeemer</span></span><span>
</span><span id="line-185"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:signature:DecrementRedeemer :: [Hash]
</span><span class="hs-keyword hs-var">signature</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Hash]
</span><a href="#local-6989586621679429219"><span class="hs-identifier hs-var">invalidSignature</span></a></span><span>
</span><span id="line-186"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:snapshotNumber:DecrementRedeemer :: SnapshotNumber
</span><span class="hs-identifier hs-var">snapshotNumber</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapshotNumber -&gt; SnapshotNumber
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="Hydra.Tx.Contract.Decrement.html#healthySnapshotNumber"><span class="hs-identifier hs-var">healthySnapshotNumber</span></a></span><span>
</span><span id="line-187"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:numberOfDecommitOutputs:DecrementRedeemer :: SnapshotNumber
</span><span class="hs-identifier hs-var">numberOfDecommitOutputs</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SnapshotNumber
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; SnapshotNumber) -&gt; Int -&gt; SnapshotNumber
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; (UTxO Era -&gt; Int) -&gt; Maybe (UTxO Era) -&gt; Int
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">UTxO Era -&gt; Int
forall era. UTxO era -&gt; Int
</span><span class="hs-identifier hs-var">UTxO.size</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (UTxO Era) -&gt; Int) -&gt; Maybe (UTxO Era) -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Snapshot Tx -&gt; Maybe (UTxOType Tx)
forall tx. Snapshot tx -&gt; Maybe (UTxOType tx)
</span><span class="hs-identifier hs-var">utxoToDecommit</span></span><span> </span><span class="annot"><span class="annottext">Snapshot Tx
</span><a href="Hydra.Tx.Contract.Decrement.html#healthySnapshot"><span class="hs-identifier hs-var">healthySnapshot</span></a></span><span>
</span><span id="line-188"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Spec: Transaction is signed by a participant</span><span>
</span><span id="line-190"></span><span>      </span><span class="annot"><span class="annottext">[Text] -&gt; DecrementMutation -&gt; Mutation -&gt; SomeMutation
forall lbl.
(Typeable lbl, Enum lbl, Bounded lbl, Show lbl) =&gt;
[Text] -&gt; lbl -&gt; Mutation -&gt; SomeMutation
</span><span class="hs-identifier hs-var">SomeMutation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text]
forall a. a -&gt; [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Text]) -&gt; Text -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HeadError -&gt; Text
forall a. ToErrorCode a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">toErrorCode</span></span><span> </span><span class="annot"><span class="annottext">HeadError
</span><span class="hs-identifier hs-var">SignerIsNotAParticipant</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DecrementMutation
</span><a href="Hydra.Tx.Contract.Decrement.html#AlterRequiredSigner"><span class="hs-identifier hs-var">AlterRequiredSigner</span></a></span><span> </span><span class="annot"><span class="annottext">(Mutation -&gt; SomeMutation) -&gt; Gen Mutation -&gt; Gen SomeMutation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-191"></span><span>        </span><span id="local-6989586621679429228"><span class="annot"><span class="annottext">Hash PaymentKey
</span><a href="#local-6989586621679429228"><span class="hs-identifier hs-var">newSigner</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Hash PaymentKey
forall keyrole.
Key keyrole =&gt;
VerificationKey keyrole -&gt; Hash keyrole
</span><span class="hs-identifier hs-var">verificationKeyHash</span></span><span> </span><span class="annot"><span class="annottext">(VerificationKey PaymentKey -&gt; Hash PaymentKey)
-&gt; Gen (VerificationKey PaymentKey) -&gt; Gen (Hash PaymentKey)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Gen (VerificationKey PaymentKey)
</span><span class="hs-identifier hs-var">genVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">Gen (VerificationKey PaymentKey)
-&gt; (VerificationKey PaymentKey -&gt; Bool)
-&gt; Gen (VerificationKey PaymentKey)
forall a. Gen a -&gt; (a -&gt; Bool) -&gt; Gen a
</span><span class="hs-operator hs-var">`suchThat`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; VerificationKey PaymentKey -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="Hydra.Tx.Contract.Decrement.html#somePartyCardanoVerificationKey"><span class="hs-identifier hs-var">somePartyCardanoVerificationKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>        </span><span class="annot"><span class="annottext">Mutation -&gt; Gen Mutation
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Mutation -&gt; Gen Mutation) -&gt; Mutation -&gt; Gen Mutation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Hash PaymentKey] -&gt; Mutation
</span><span class="hs-identifier hs-var">ChangeRequiredSigners</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Hash PaymentKey
</span><a href="#local-6989586621679429228"><span class="hs-identifier hs-var">newSigner</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; DecrementMutation -&gt; Mutation -&gt; SomeMutation
forall lbl.
(Typeable lbl, Enum lbl, Bounded lbl, Show lbl) =&gt;
[Text] -&gt; lbl -&gt; Mutation -&gt; SomeMutation
</span><span class="hs-identifier hs-var">SomeMutation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text]
forall a. a -&gt; [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Text]) -&gt; Text -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HeadError -&gt; Text
forall a. ToErrorCode a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">toErrorCode</span></span><span> </span><span class="annot"><span class="annottext">HeadError
</span><span class="hs-identifier hs-var">SignatureVerificationFailed</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DecrementMutation
</span><a href="Hydra.Tx.Contract.Decrement.html#ChangeDecrementedValue"><span class="hs-identifier hs-var">ChangeDecrementedValue</span></a></span><span> </span><span class="annot"><span class="annottext">(Mutation -&gt; SomeMutation) -&gt; Gen Mutation -&gt; Gen SomeMutation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-194"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679429231"><span class="annot"><span class="annottext">outs :: [TxOut CtxTx]
</span><a href="#local-6989586621679429231"><span class="hs-identifier hs-var hs-var">outs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; [TxOut CtxTx]
forall era. Tx era -&gt; [TxOut CtxTx era]
</span><span class="hs-identifier hs-var">txOuts'</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679429204"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-comment">-- NOTE: Skip the first output since this is the Head output.</span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679429233"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679429233"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679429234"><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679429234"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Int, TxOut CtxTx)] -&gt; Gen (Int, TxOut CtxTx)
forall a. HasCallStack =&gt; [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; [TxOut CtxTx] -&gt; [(Int, TxOut CtxTx)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx]
</span><a href="#local-6989586621679429231"><span class="hs-identifier hs-var">outs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx]
</span><a href="#local-6989586621679429231"><span class="hs-identifier hs-var">outs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>        </span><span id="local-6989586621679429236"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679429236"><span class="hs-identifier hs-var">value'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Gen Value
</span><span class="hs-identifier hs-var">genValue</span></span><span> </span><span class="annot"><span class="annottext">Gen Value -&gt; (Value -&gt; Bool) -&gt; Gen Value
forall a. Gen a -&gt; (a -&gt; Bool) -&gt; Gen a
</span><span class="hs-operator hs-var">`suchThat`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679429234"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>        </span><span class="annot"><span class="annottext">Mutation -&gt; Gen Mutation
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Mutation -&gt; Gen Mutation) -&gt; Mutation -&gt; Gen Mutation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; TxOut CtxTx -&gt; Mutation
</span><span class="hs-identifier hs-var">ChangeOutput</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679429233"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Value -&gt; Value) -&gt; TxOut CtxTx -&gt; TxOut CtxTx
forall era ctx.
IsMaryBasedEra era =&gt;
(Value -&gt; Value) -&gt; TxOut ctx era -&gt; TxOut ctx era
</span><span class="hs-identifier hs-var">modifyTxOutValue</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679429236"><span class="hs-identifier hs-var">value'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679429234"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Spec: The value in the head output is decreased accordingly</span><span>
</span><span id="line-200"></span><span>      </span><span class="annot"><span class="annottext">[Text] -&gt; DecrementMutation -&gt; Mutation -&gt; SomeMutation
forall lbl.
(Typeable lbl, Enum lbl, Bounded lbl, Show lbl) =&gt;
[Text] -&gt; lbl -&gt; Mutation -&gt; SomeMutation
</span><span class="hs-identifier hs-var">SomeMutation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text]
forall a. a -&gt; [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Text]) -&gt; Text -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HeadError -&gt; Text
forall a. ToErrorCode a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">toErrorCode</span></span><span> </span><span class="annot"><span class="annottext">HeadError
</span><span class="hs-identifier hs-var">HeadValueIsNotPreserved</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DecrementMutation
</span><a href="Hydra.Tx.Contract.Decrement.html#ChangeHeadValue"><span class="hs-identifier hs-var">ChangeHeadValue</span></a></span><span> </span><span class="annot"><span class="annottext">(Mutation -&gt; SomeMutation) -&gt; Gen Mutation -&gt; Gen SomeMutation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-201"></span><span>        </span><span id="local-6989586621679429240"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679429240"><span class="hs-identifier hs-var">newValue</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Gen Value
</span><span class="hs-identifier hs-var">genValue</span></span><span> </span><span class="annot"><span class="annottext">Gen Value -&gt; (Value -&gt; Bool) -&gt; Gen Value
forall a. Gen a -&gt; (a -&gt; Bool) -&gt; Gen a
</span><span class="hs-operator hs-var">`suchThat`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679429212"><span class="hs-identifier hs-var">headTxOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>        </span><span class="annot"><span class="annottext">Mutation -&gt; Gen Mutation
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Mutation -&gt; Gen Mutation) -&gt; Mutation -&gt; Gen Mutation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; TxOut CtxTx -&gt; Mutation
</span><span class="hs-identifier hs-var">ChangeOutput</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679429212"><span class="hs-identifier hs-var">headTxOut</span></a></span><span class="hs-special">{</span><span class="annot"><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679429240"><span class="hs-identifier hs-type">newValue</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; DecrementMutation -&gt; Mutation -&gt; SomeMutation
forall lbl.
(Typeable lbl, Enum lbl, Bounded lbl, Show lbl) =&gt;
[Text] -&gt; lbl -&gt; Mutation -&gt; SomeMutation
</span><span class="hs-identifier hs-var">SomeMutation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text]
forall a. a -&gt; [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Text]) -&gt; Text -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HeadError -&gt; Text
forall a. ToErrorCode a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">toErrorCode</span></span><span> </span><span class="annot"><span class="annottext">HeadError
</span><span class="hs-identifier hs-var">SignatureVerificationFailed</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DecrementMutation
</span><a href="Hydra.Tx.Contract.Decrement.html#DropDecommitOutput"><span class="hs-identifier hs-var">DropDecommitOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(Mutation -&gt; SomeMutation) -&gt; Gen Mutation -&gt; Gen SomeMutation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-204"></span><span>        </span><span id="local-6989586621679429241"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679429241"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Gen Int
forall a. Random a =&gt; (a, a) -&gt; Gen a
</span><span class="hs-identifier hs-var">choose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; [TxOut CtxTx]
forall era. Tx era -&gt; [TxOut CtxTx era]
</span><span class="hs-identifier hs-var">txOuts'</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679429204"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>        </span><span class="annot"><span class="annottext">Mutation -&gt; Gen Mutation
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Mutation -&gt; Gen Mutation) -&gt; Mutation -&gt; Gen Mutation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Mutation
</span><span class="hs-identifier hs-var">RemoveOutput</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679429241"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; DecrementMutation -&gt; Mutation -&gt; SomeMutation
forall lbl.
(Typeable lbl, Enum lbl, Bounded lbl, Show lbl) =&gt;
[Text] -&gt; lbl -&gt; Mutation -&gt; SomeMutation
</span><span class="hs-identifier hs-var">SomeMutation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Text]
forall a. a -&gt; [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Text]) -&gt; Text -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HeadError -&gt; Text
forall a. ToErrorCode a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">toErrorCode</span></span><span> </span><span class="annot"><span class="annottext">HeadError
</span><span class="hs-identifier hs-var">HeadValueIsNotPreserved</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DecrementMutation
</span><a href="Hydra.Tx.Contract.Decrement.html#ExtractSomeValue"><span class="hs-identifier hs-var">ExtractSomeValue</span></a></span><span> </span><span class="annot"><span class="annottext">(Mutation -&gt; SomeMutation) -&gt; Gen Mutation -&gt; Gen SomeMutation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-207"></span><span>        </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; PolicyId -&gt; Gen Mutation
</span><a href="Hydra.Tx.Contract.CollectCom.html#extractHeadOutputValue"><span class="hs-identifier hs-var">extractHeadOutputValue</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679429212"><span class="hs-identifier hs-var">headTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><span class="hs-identifier hs-var">testPolicyId</span></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-209"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-210"></span><span>  </span><span id="local-6989586621679429212"><span class="annot"><span class="annottext">headTxOut :: TxOut CtxTx
</span><a href="#local-6989586621679429212"><span class="hs-identifier hs-var hs-var">headTxOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (TxOut CtxTx) -&gt; TxOut CtxTx
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (TxOut CtxTx) -&gt; TxOut CtxTx)
-&gt; Maybe (TxOut CtxTx) -&gt; TxOut CtxTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6yqv51fa4w5nds6fi2vvj8v5ww7f1h5g-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tx -&gt; [TxOut CtxTx]
forall era. Tx era -&gt; [TxOut CtxTx era]
</span><span class="hs-identifier hs-var">txOuts'</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679429204"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx] -&gt; Int -&gt; Maybe (TxOut CtxTx)
forall a. [a] -&gt; Int -&gt; Maybe a
</span><span class="hs-operator hs-var">!!?</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-211"></span></pre></body></html>