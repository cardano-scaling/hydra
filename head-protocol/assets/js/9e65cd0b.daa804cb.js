"use strict";(self.webpackChunkhydra_head_protocol_docs=self.webpackChunkhydra_head_protocol_docs||[]).push([[705],{49166:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"audit-guidelines","title":"Audit guidelines","description":"This document contains guidelines for anyone who decides to perform an assessment on the security of the Hydra Head protocol specification and implementation released from this repository.","source":"@site/standalone/audit-guidelines.md","sourceDirName":".","slug":"/audit-guidelines","permalink":"/head-protocol/audit-guidelines","draft":false,"unlisted":false,"editUrl":"https://github.com/cardano-scaling/hydra/tree/master/docs/standalone/audit-guidelines.md","tags":[],"version":"current","frontMatter":{}}');var s=t(74848),a=t(28453);const o={},r="Audit guidelines",d={},c=[{value:"Reporting a Vulnerability",id:"reporting-a-vulnerability",level:2},{value:"Context and assumptions",id:"context-and-assumptions",level:2},{value:"Suggested Tasks",id:"suggested-tasks",level:2},{value:"Specification is sound",id:"specification-is-sound",level:3},{value:"Scripts are consistent with specification",id:"scripts-are-consistent-with-specification",level:3},{value:"Hydra node produces consistent transactions",id:"hydra-node-produces-consistent-transactions",level:3},{value:"Out of Scope",id:"out-of-scope",level:2},{value:"Artifacts",id:"artifacts",level:2},{value:"Artifact 1: Hydra Head Specification",id:"artifact-1-hydra-head-specification",level:3},{value:"Artifact 2: Hydra Head Protocol Implementation",id:"artifact-2-hydra-head-protocol-implementation",level:3},{value:"Artifact 2.1: Hydra plutus scripts (on-chain code)",id:"artifact-21-hydra-plutus-scripts-on-chain-code",level:4},{value:"Artifact 2.2: Hydra node chain layer code (off-chain code)",id:"artifact-22-hydra-node-chain-layer-code-off-chain-code",level:4}];function l(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"audit-guidelines",children:"Audit guidelines"})}),"\n",(0,s.jsx)(n.p,{children:"This document contains guidelines for anyone who decides to perform an assessment on the security of the Hydra Head protocol specification and implementation released from this repository."}),"\n",(0,s.jsx)(n.p,{children:"Hydra is an open-source project and, as such, can be freely used, reviewed and audited. Shall you want to perform a\nsecurity audit, the hydra team would suggest to apply static and dynamic analysis, focused, but not limited to, the areas of concern below."}),"\n",(0,s.jsxs)(n.p,{children:["Shall you decide to share your findings with us, please consider the following, as Per ",(0,s.jsx)(n.a,{href:"https://github.com/cardano-foundation/CIPs/tree/master/CIP-0052",children:"CIP-52"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Any discrepancies, deviations or spotted vulnerabilities shall be described and classified with an appropriate severity level. Recommendations to rectify the identified deficiencies shall also be provided whenever appropriate."}),"\n",(0,s.jsx)(n.li,{children:"When automated tools are used as a replacement for manual review/code inspection, they shall be documented or referenced. Note that it\u2019s the responsibility of the auditor to ensure that such tooling may not exhibit potential failures that can adversely affect the review outcome."}),"\n",(0,s.jsx)(n.li,{children:"Any strategies/methodologies used to assess the consistency, correctness and completeness of the requirements shall also be documented or referenced."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"reporting-a-vulnerability",children:"Reporting a Vulnerability"}),"\n",(0,s.jsxs)(n.p,{children:["If you discover a security vulnerability in Hydra, we ask that you report it to us confidentially. See ",(0,s.jsx)(n.a,{href:"https://github.com/cardano-scaling/hydra/blob/master/SECURITY.md",children:(0,s.jsx)(n.code,{children:"SECURITY.md"})})," on how to report a security vulnerability."]}),"\n",(0,s.jsx)(n.h2,{id:"context-and-assumptions",children:"Context and assumptions"}),"\n",(0,s.jsxs)(n.p,{children:["The Hydra Head protocol is implemented in the ",(0,s.jsx)(n.code,{children:"hydra-node"}),", which connects to the Cardano network as layer 1 (L1) through a ",(0,s.jsx)(n.code,{children:"cardano-node"}),", to other Hydra Head compliant nodes over an off-chain network, and exposes an API to users of the layer 2. Most relevant artifacts for an audit are:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Hydra Head Specification"}),"\n",(0,s.jsx)(n.li,{children:"Hydra plutus scripts (on-chain code)"}),"\n",(0,s.jsx)(n.li,{children:"Hydra node chain layer code (off-chain code)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"As described in the following figure, the main entry points of a Hydra node are:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The API through which a client can connect to the node;"}),"\n",(0,s.jsx)(n.li,{children:"The network communication with other Hydra node peers;"}),"\n",(0,s.jsx)(n.li,{children:"The transactions posted on the Cardano ledger (accessed through a network connection)."}),"\n"]}),"\n",(0,s.jsx)("center",{children:(0,s.jsx)("img",{src:t(81756).A,style:{width:600}})}),"\n",(0,s.jsxs)(n.p,{children:["A detailed description of each of the artifacts relevant for an audit can be found in the above section ",(0,s.jsx)(n.em,{children:"Artifacts"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"For its operations, the hydra-node process relies on a cardano-node process and client processes can connect to the hydra-node process through API.\nGenerally, we recommend to run the Hydra and cardano node in a trusted environment so that any assessment performed during an audit should be done under the following assumptions:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Organizational procedures for managing the hydra and cardano signing keys are trusted;"}),"\n",(0,s.jsx)(n.li,{children:"The system running the hydra-node is trusted;"}),"\n",(0,s.jsx)(n.li,{children:"The cardano-node software is trusted as is the system running it;"}),"\n",(0,s.jsx)(n.li,{children:"Any client software connecting through the API is trusted as are the systems running them;"}),"\n",(0,s.jsx)(n.li,{children:"The communications between the cardano-node and the hydra-node are trusted;"}),"\n",(0,s.jsx)(n.li,{children:"The communications between the hydra-node and any client software connecting through the API are trusted;"}),"\n",(0,s.jsx)(n.li,{children:"The cardano-node is assumed to have a responsive communication line with the Cardano network such that the hydra-node can react to on-chain transactions in a timely manner. In particular, hydra-node is able to observe head closure and contest in a delay shorter than the contestation period fixed by the protocol."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"What is not explicitly trusted in the above list is deemed untrusted. In particular, the other hydra nodes participating in a head are not trusted."}),"\n",(0,s.jsx)(n.p,{children:"We would appreciate comments about any of the above. Especially if you can suggest less restricting assumptions under which the security properties of Hydra still hold. Or practical suggestions on how to implement these assumptions. We also appreciate recommendations about how to ensure these assumptions hold in a real environment."}),"\n",(0,s.jsx)(n.p,{children:"If you plan to consider a different operational environment were these assumptions would not be true and plan to share your discoveries with us, please be as explicit as possible about the corresponding assumptions."}),"\n",(0,s.jsx)(n.h2,{id:"suggested-tasks",children:"Suggested Tasks"}),"\n",(0,s.jsxs)(n.p,{children:["Broadly speaking, an audit would probably want to ensure that the security properties proven in ",(0,s.jsx)(n.em,{children:"Hydra Head Specification"})," hold for the implementation, taking also into account the main entry points of a ",(0,s.jsx)(n.code,{children:"hydra-node"})," which are the node to node network communications, the API and the Cardano ledger.\nFurthermore, we suggest to focus efforts on ensuring correctness and robustness of the ",(0,s.jsx)(n.em,{children:"Hydra plutus scripts"})," (on-chain code) as it is harder (or impossible) to fix in the field and attackers could side-step all measures but the on-chain code (i.e. use their own off-chain code)."]}),"\n",(0,s.jsx)(n.p,{children:"We suggest auditors to assess the following statements, which will be detailed in the next sections:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Hydra Head specification proofs are sound."}),"\n",(0,s.jsx)(n.li,{children:"Hydra plutus scripts (on-chain code) are consistent with Hydra Head V1 specification and immune to common Cardano smart-contract weaknesses."}),"\n",(0,s.jsx)(n.li,{children:"Hydra node chain layer code generates transactions which are consistent with Hydra Head V1 specification."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"specification-is-sound",children:"Specification is sound"}),"\n",(0,s.jsx)(n.p,{children:"The Hydra Head specification describes the Hydra Head Protocol."}),"\n",(0,s.jsx)(n.p,{children:"This specification provides several important security properties:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Consistency: No two uncorrupted parties see conflicting transactions confirmed."}),"\n",(0,s.jsx)(n.li,{children:"Liveness: If all parties remain uncorrupted and the adversary delivers all messages, then every transaction becomes confirmed at some point."}),"\n",(0,s.jsx)(n.li,{children:"Soundness: The final UTxO set accepted on the mainchain results from a set of seen transactions."}),"\n",(0,s.jsx)(n.li,{children:"Completeness: All transactions observed as confirmed by an honest party at the end of the protocol are considered on the mainchain."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"You could review this specification to share comments and assess that the above properties hold. An outcome of such a review could include, without being limited to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Identification of any inconsistencies or lack of generality within the specification;"}),"\n",(0,s.jsx)(n.li,{children:"Identification of any inconsistencies in the proofs exposed in the specification;"}),"\n",(0,s.jsx)(n.li,{children:"Identification of any behavior that could lead, with an adversarial mindset, to one of the above properties to be falsified."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"scripts-are-consistent-with-specification",children:"Scripts are consistent with specification"}),"\n",(0,s.jsx)(n.p,{children:"The Hydra Head specification defines the checks the on-chain scripts must perform for a functioning Hydra Head."}),"\n",(0,s.jsx)(n.p,{children:"You could assess that the Hydra plutus scripts are consistent with the Hydra Head specification and immune to common possible vulnerabilities for Cardano smart contracts, such as but not limited to the following attacks:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Execution cost limits;"}),"\n",(0,s.jsx)(n.li,{children:"Double satisfaction;"}),"\n",(0,s.jsx)(n.li,{children:"Replay;"}),"\n",(0,s.jsx)(n.li,{children:"Denial of service."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The outcome of the review could also include, without being limited to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"a validation that the Hydra plutus scripts validators do check the transaction constraints defined in the Hydra Head specification;"}),"\n",(0,s.jsx)(n.li,{children:"a review and comment on the mutation-based tests applied to the Hydra plutus scripts and, in particular, any adversarial situation that would not be covered by them but should be."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["See ",(0,s.jsx)(n.a,{href:"https://plutus.readthedocs.io/en/latest/reference/writing-scripts/common-weaknesses/index.html",children:"Common Weaknesses"})," and ",(0,s.jsx)(n.a,{href:"https://github.com/Plutonomicon/plutonomicon/blob/main/vulnerabilities.md",children:"Vulnerabilities"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"hydra-node-produces-consistent-transactions",children:"Hydra node produces consistent transactions"}),"\n",(0,s.jsx)(n.p,{children:"The Hydra Head specification defines the transactions the off-chain code should build and post to evolve the head status on-chain."}),"\n",(0,s.jsx)(n.p,{children:"You could assess that the Hydra node chain layer code can only build transactions which are consistent with the Hydra Head specification."}),"\n",(0,s.jsx)(n.h2,{id:"out-of-scope",children:"Out of Scope"}),"\n",(0,s.jsx)(n.p,{children:"For a first security audit, the Hydra team suggests to focus on the scope described in the above sections and consider anything else as out of scope.\nIn particular, the following items should be seen as out of scope:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Hydra Head protocol implementation is immune to attacks via chain transactions."}),"\n",(0,s.jsx)(n.li,{children:"Hydra Head protocol implementation is immune to attacks via network."}),"\n",(0,s.jsx)(n.li,{children:"Hydra Head protocol implementation faithfully reflects the head state through the API."}),"\n",(0,s.jsx)(n.li,{children:"Hydra Head protocol implementation is immune to API attacks."}),"\n",(0,s.jsx)(n.li,{children:"Any attack which would be invalid under the assumptions stated above in the document."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"artifacts",children:"Artifacts"}),"\n",(0,s.jsx)(n.p,{children:"This sections gives a detailed description of the artifacts mentioned above in the document:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Hydra Head Specification"}),"\n",(0,s.jsx)(n.li,{children:"Hydra plutus scripts (on-chain code)"}),"\n",(0,s.jsx)(n.li,{children:"Hydra node chain layer code (off-chain code)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"artifact-1-hydra-head-specification",children:"Artifact 1: Hydra Head Specification"}),"\n",(0,s.jsxs)(n.p,{children:["The Hydra Head protocol implementation derives from ",(0,s.jsx)(n.a,{href:"https://eprint.iacr.org/2020/299.pdf",children:"Hydra: Fast Isomorphic State Channels"})," in several ways. Especially some simplifications have been introduced and generalizations removed."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.a,{href:"/docs/dev/specification",children:"Hydra Head specification"}),' captures these deviations and also includes the "formal notation" of the actual transaction constraints (which are foregone in the original paper). Also, it details the L2 protocol logic for the ',(0,s.jsx)(n.strong,{children:"Coordinated"})," Head protocol - which is implemented in V1."]}),"\n",(0,s.jsx)(n.h3,{id:"artifact-2-hydra-head-protocol-implementation",children:"Artifact 2: Hydra Head Protocol Implementation"}),"\n",(0,s.jsxs)(n.p,{children:["With Hydra Head Protocol Implementation we refer to the software component that is used to operate a node in the Hydra Head protocol. The ",(0,s.jsx)(n.code,{children:"hydra-node"})," allows its users to open a head, lock funds in it, connect to peers, process transactions as a layer 2, close a head and unlock the corresponding funds. It is comprised by the Hydra plutus scripts, Hydra head chain layer, layer 2 code, network communication between peers, and an API for clients to connect and use the node."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Source code repository: ",(0,s.jsx)(n.a,{href:"https://github.com/cardano-scaling/hydra",children:"cardano-scaling/hydra"})]}),"\n",(0,s.jsxs)(n.li,{children:["Version ready to be audited: Any ",(0,s.jsx)(n.a,{href:"https://github.com/cardano-scaling/hydra/releases",children:"release"})," after version 0.10.0"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The following parts are described below:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Hydra plutus scripts (on-chain code)"}),"\n",(0,s.jsx)(n.li,{children:"Hydra node chain layer code (off-chain code)"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"artifact-21-hydra-plutus-scripts-on-chain-code",children:"Artifact 2.1: Hydra plutus scripts (on-chain code)"}),"\n",(0,s.jsxs)(n.p,{children:["Hydra plutus scripts source code can be found in the ",(0,s.jsx)(n.a,{href:"https://github.com/cardano-scaling/hydra/tree/master/hydra-plutus",children:"hydra-plutus module"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Hydra plutus mutation based testing can be found in the ",(0,s.jsx)(n.a,{href:"https://github.com/cardano-scaling/hydra/tree/master/hydra-node",children:"hydra-node module"})," in test/Hydra/Chain/Direct/Contract/."]}),"\n",(0,s.jsx)(n.h4,{id:"artifact-22-hydra-node-chain-layer-code-off-chain-code",children:"Artifact 2.2: Hydra node chain layer code (off-chain code)"}),"\n",(0,s.jsxs)(n.p,{children:["Hydra node chain layer code can be found in the ",(0,s.jsx)(n.a,{href:"https://github.com/cardano-scaling/hydra/tree/master/hydra-node/src/Hydra/Chain",children:"hydra-node module"})," in src/Hydra/Chain/Direct/"]}),"\n",(0,s.jsxs)(n.p,{children:["Hydra node chain layer tests can be found in the ",(0,s.jsx)(n.a,{href:"https://github.com/cardano-scaling/hydra/tree/master/hydra-node/test/Hydra/Chain",children:"hydra-node module"})," in test/Hydra/Chain/Direct/"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},81756:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/artifacts-a428f525441701114d815bb1cb55786e.png"},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var i=t(96540);const s={},a=i.createContext(s);function o(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);