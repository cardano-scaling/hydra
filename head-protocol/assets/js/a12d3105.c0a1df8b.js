"use strict";(self.webpackChunkhydra_head_protocol_docs=self.webpackChunkhydra_head_protocol_docs||[]).push([[3946],{45763:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"how-to/commit-blueprint","title":"Commit using a blueprint","description":"This guide provides a walkthrough on using cardano-cli to assemble the necessary components for committing funds to a head using a blueprint transaction.","source":"@site/docs/how-to/commit-blueprint.md","sourceDirName":"how-to","slug":"/how-to/commit-blueprint","permalink":"/head-protocol/docs/how-to/commit-blueprint","draft":false,"unlisted":false,"editUrl":"https://github.com/cardano-scaling/hydra/tree/master/docs/docs/how-to/commit-blueprint.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"userDocumentation","previous":{"title":"Configuration","permalink":"/head-protocol/docs/configuration"},"next":{"title":"Commit a Script UTxO into a Head","permalink":"/head-protocol/docs/how-to/commit-script-utxo"}}');var c=t(74848),d=t(28453);const i={sidebar_position:1},a="Commit using a blueprint",r={},o=[{value:"Step 1",id:"step-1",level:2},{value:"Step 2",id:"step-2",level:2},{value:"Step 3",id:"step-3",level:2},{value:"Step 4",id:"step-4",level:2},{value:"Step 5",id:"step-5",level:2}];function l(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"commit-using-a-blueprint",children:"Commit using a blueprint"})}),"\n",(0,c.jsxs)(n.p,{children:["This guide provides a walkthrough on using ",(0,c.jsx)(n.code,{children:"cardano-cli"})," to assemble the necessary components for committing funds to a ",(0,c.jsx)(n.code,{children:"head"})," using a blueprint transaction."]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Prerequisites"})}),"\n",(0,c.jsx)(n.p,{children:"You should have access to the following repositories:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"hydra-node"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.code,{children:"hydra-tui"})}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"cardano-cli"}),", and"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"curl"})," binaries."]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"step-1",children:"Step 1"}),"\n",(0,c.jsxs)(n.p,{children:["You can use ",(0,c.jsx)(n.code,{children:"cardano-cli"})," to create a ",(0,c.jsx)(n.em,{children:"blueprint"})," transaction from some ",(0,c.jsx)(n.code,{children:"UTXO"})," you own. First, initiate a Cardano node on the pre-production network:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"./testnets/cardano-node.sh ~/code/hydra/testnets/preprod\n"})}),"\n",(0,c.jsx)(n.h2,{id:"step-2",children:"Step 2"}),"\n",(0,c.jsxs)(n.p,{children:["Determine which ",(0,c.jsx)(n.code,{children:"UTXO"})," you intend to commit to the ",(0,c.jsx)(n.code,{children:"head"}),". This example uses Alice's external wallet key to identify her address:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"cardano-cli address build \\\n --payment-verification-key-file hydra-cluster/config/credentials/alice-funds.vk \\\n --testnet-magic 1\n\naddr_test1vp5cxztpc6hep9ds7fjgmle3l225tk8ske3rmwr9adu0m6qchmx5z\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Next, query to see what ",(0,c.jsx)(n.code,{children:"UTXO"})," Alice has:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:'cardano-cli query utxo \\\n   --socket-path testnets/preprod/node.socket \\\n   --address addr_test1vp5cxztpc6hep9ds7fjgmle3l225tk8ske3rmwr9adu0m6qchmx5z \\\n   --testnet-magic 1 \\\n   --output-json\n\n{\n    "14ab373afb1112d925b0f6a84518ac26d4a8cfcc99231e1f47e6996182e843a9#0": {\n        "address": "addr_test1vp5cxztpc6hep9ds7fjgmle3l225tk8ske3rmwr9adu0m6qchmx5z",\n        "datum": null,\n        "datumhash": null,\n        "inlineDatum": null,\n        "referenceScript": null,\n        "value": {\n            "lovelace": 8000000\n        }\n    },\n    "14ab373afb1112d925b0f6a84518ac26d4a8cfcc99231e1f47e6996182e843a9#1": {\n        "address": "addr_test1vp5cxztpc6hep9ds7fjgmle3l225tk8ske3rmwr9adu0m6qchmx5z",\n        "datum": null,\n        "datumhash": null,\n        "inlineDatum": null,\n        "referenceScript": null,\n        "value": {\n            "lovelace": 1828427\n        }\n    },\n}\n'})}),"\n",(0,c.jsx)(n.h2,{id:"step-3",children:"Step 3"}),"\n",(0,c.jsxs)(n.p,{children:["Select the first ",(0,c.jsx)(n.code,{children:"UTXO"}),", which has eight ada available. Use five ada to commit and rely on ",(0,c.jsx)(n.code,{children:"hydra-node"})," to balance the commit transaction:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"cardano-cli conway transaction build-raw \\\n  --tx-in 14ab373afb1112d925b0f6a84518ac26d4a8cfcc99231e1f47e6996182e843a9#0 \\\n  --tx-out addr_test1vp5cxztpc6hep9ds7fjgmle3l225tk8ske3rmwr9adu0m6qchmx5z+5000000 \\\n  --fee 0 \\\n  --out-file tx.json\n"})}),"\n",(0,c.jsx)(n.h2,{id:"step-4",children:"Step 4"}),"\n",(0,c.jsxs)(n.p,{children:["You should now have the ",(0,c.jsx)(n.em,{children:"blueprint"})," transaction in the ",(0,c.jsx)(n.code,{children:"tx.json"})," file. For ",(0,c.jsx)(n.code,{children:"hydra-node"})," to provide a draft commit transaction, you need to:"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Obtain the protocol parameters needed to run the ",(0,c.jsx)(n.code,{children:"hydra-node"})]}),"\n",(0,c.jsxs)(n.li,{children:["Ensure the ",(0,c.jsx)(n.code,{children:"hydra-node"})," is up and running"]}),"\n",(0,c.jsxs)(n.li,{children:["Have the ",(0,c.jsx)(n.code,{children:"head"})," in the initializing state"]}),"\n",(0,c.jsxs)(n.li,{children:["Submit the HTTP request to the ",(0,c.jsx)(n.code,{children:"hydra-node"})," API server using the ",(0,c.jsx)(n.em,{children:"blueprint"})," transaction you just created and the ",(0,c.jsx)(n.code,{children:"UTXO"})," used for its input."]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"Query the protocol parameters:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"cardano-cli query protocol-parameters \\\n  --testnet-magic 1 \\\n  --socket-path testnets/preprod/node.socket \\\n  --out-file pp-preprod.json\n"})}),"\n",(0,c.jsx)(n.h2,{id:"step-5",children:"Step 5"}),"\n",(0,c.jsxs)(n.p,{children:["Start the ",(0,c.jsx)(n.code,{children:"hydra-node"})," as a ",(0,c.jsx)(n.em,{children:"single"})," party head instance."]}),"\n",(0,c.jsxs)(n.p,{children:["Note: The value ",(0,c.jsx)(n.code,{children:"6264cee4d5eab3fb58ab67f3899ecbcc0d7e72732a2d9c1c5d638115db6ca711"})," comes from the ",(0,c.jsx)(n.code,{children:"hydra-node"})," release ",(0,c.jsx)(n.a,{href:"https://github.com/cardano-scaling/hydra/releases/tag/0.16.0",children:"0.16.0"}),"."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"hydra-node \\\n  --node-id 1 --listen 0.0.0.0:5001 --api-port 4001 \\\n  --hydra-signing-key demo/alice.sk \\\n  --hydra-scripts-tx-id 6264cee4d5eab3fb58ab67f3899ecbcc0d7e72732a2d9c1c5d638115db6ca711 \\\n  --cardano-signing-key hydra-cluster/config/credentials/alice.sk \\\n  --ledger-protocol-parameters pp-preprod.json \\\n  --testnet-magic 1 \\\n  --node-socket testnets/preprod/node.socket \\\n  --persistence-dir .\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Now you can start ",(0,c.jsx)(n.code,{children:"hydra-tui"})," and initialize the ",(0,c.jsx)(n.code,{children:"head"}),":"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"hydra-tui \\\n  --connect 0.0.0.0:4001 \\\n  --cardano-signing-key hydra-cluster/config/credentials/alice-funds.sk \\\n  --testnet-magic 1 \\\n  --node-socket testnets/preprod/node.socket\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Press ",(0,c.jsx)(n.code,{children:"i"})," to initialize the ",(0,c.jsx)(n.code,{children:"head"}),". Once the head is in the ",(0,c.jsx)(n.code,{children:"Initializing"})," state, you can send the HTTP request to the ",(0,c.jsx)(n.code,{children:"/commit"})," API path. Assemble the request body using the ",(0,c.jsx)(n.code,{children:"cborHex"})," field from the tx-body file ",(0,c.jsx)(n.code,{children:"tx.json"})," and the JSON representation of the ",(0,c.jsx)(n.code,{children:"UTXO"})," you used as input."]}),"\n",(0,c.jsx)(n.p,{children:"This is the valid JSON request:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n  "blueprintTx": {\n    "cborHex": "84a3008182582014ab373afb1112d925b0f6a84518ac26d4a8cfcc99231e1f47e6996182e843a900018182581d6069830961c6af9095b0f2648dff31fa9545d8f0b6623db865eb78fde81a007a12000200a0f5f6",\n    "description": "",\n    "type": "Tx BabbageEra"\n  },\n  "utxo": {\n    "14ab373afb1112d925b0f6a84518ac26d4a8cfcc99231e1f47e6996182e843a9#0": {\n      "address": "addr_test1vp5cxztpc6hep9ds7fjgmle3l225tk8ske3rmwr9adu0m6qchmx5z",\n      "datum": null,\n      "datumhash": null,\n      "inlineDatum": null,\n      "referenceScript": null,\n      "value": {\n        "lovelace": 8000000\n      }\n    }\n  }\n}\n'})}),"\n",(0,c.jsxs)(n.p,{children:["Save this JSON to a ",(0,c.jsx)(n.code,{children:"commit-request.json"})," file."]}),"\n",(0,c.jsxs)(n.p,{children:["You can now prompt the running ",(0,c.jsx)(n.code,{children:"hydra-node"})," to draft a commit transaction:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"curl -X POST 127.0.0.1:4001/commit \\\n  --data @commit-request.json\n\n"})}),"\n",(0,c.jsxs)(n.p,{children:["This yields a large CBOR blob, which you can save to the ",(0,c.jsx)(n.code,{children:"commit-tx.json"})," file."]}),"\n",(0,c.jsx)(n.p,{children:"Next, sign and submit the draft of the commit transaction:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"\ncardano-cli conway transaction sign \\\n  --tx-file commit-tx.json \\\n  --signing-key-file hydra-cluster/config/credentials/alice-funds.sk \\\n  --out-file signed-tx.json\n\n\ncardano-cli conway transaction submit \\\n  --tx-file signed-tx.json \\\n  --socket-path testnets/preprod/node.socket \\\n  --testnet-magic 1\n"})}),"\n",(0,c.jsxs)(n.p,{children:["If you start the ",(0,c.jsx)(n.code,{children:"hydra-tui"})," and wait until the transaction you just sent is re-observed by the ",(0,c.jsx)(n.code,{children:"hydra-node"}),", you should see that the head is now open."]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var s=t(96540);const c={},d=s.createContext(c);function i(e){const n=s.useContext(d);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),s.createElement(d.Provider,{value:n},e.children)}}}]);