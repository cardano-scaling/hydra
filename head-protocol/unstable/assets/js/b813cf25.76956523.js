"use strict";(self.webpackChunkhydra_head_protocol_docs=self.webpackChunkhydra_head_protocol_docs||[]).push([[9597],{80926:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>o});var s=t(2944),i=t(74848),c=t(28453);const a={slug:14,title:"14. Token usage in Hydra Scripts\n",authors:[],tags:["Accepted"]},d=void 0,r={authorsImageUrls:[]},o=[{value:"Status",id:"status",level:2},{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"Consequences",id:"consequences",level:2},{value:"Follow-up questions",id:"follow-up-questions",level:2}];function l(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"status",children:"Status"}),"\n",(0,i.jsx)(n.p,{children:"Accepted"}),"\n",(0,i.jsx)(n.h2,{id:"context",children:"Context"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The Hydra on-chain-verification scripts are used to validate Hydra protocol transactions and ensure they are lawful."}),"\n",(0,i.jsxs)(n.li,{children:["At least these three properties need to be enforced:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Authentication: ensure that only Head participants can, for example, ",(0,i.jsx)(n.code,{children:"abort"})," a Head"]}),"\n",(0,i.jsxs)(n.li,{children:["Contract continuity: ensure that a Head was ",(0,i.jsx)(n.code,{children:"init"}),"ialized before it can be opened by a ",(0,i.jsx)(n.code,{children:"collectCom"})," tx."]}),"\n",(0,i.jsxs)(n.li,{children:["Completeness: ensure that all Head participants had chance to ",(0,i.jsx)(n.code,{children:"commit"})," funds to a Head."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["The Hydra Head paper introduces ",(0,i.jsx)(n.strong,{children:"participation tokens (PT)"})," and a ",(0,i.jsx)(n.strong,{children:"state thread token (ST)"})," for that matter."]}),"\n",(0,i.jsxs)(n.li,{children:["Such tokens (a.k.a native assets) are identified by the ",(0,i.jsx)(n.code,{children:"CurrencySymbol"}),", that is the hash of their ",(0,i.jsx)(n.code,{children:"MintingPolicyScript"})," (a.k.a ",(0,i.jsx)(n.code,{children:"PolicyID"})," in the ledger), and a ",(0,i.jsx)(n.code,{children:"ByteString"}),", the socalled ",(0,i.jsx)(n.code,{children:"TokenName"})," (a.k.a as ",(0,i.jsx)(n.code,{children:"AssetName"})," in the ledger, see ",(0,i.jsx)(n.a,{href:"https://hydra.iohk.io/job/Cardano/cardano-ledger-specs/specs.shelley-ma/latest/download-by-type/doc-pdf/shelley-ma#subsection.3.2",children:"shelley-ma ledger spec"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["There can be multiple Hydra Heads on a network and a ",(0,i.jsx)(n.code,{children:"hydra-node"})," need to distinguish individual Head instances or even (later) keep track of multiple Heads. Concretely, this means that we need to infer a Head identifier (",(0,i.jsx)(n.code,{children:"HeadId"}),") from observing each of the Hydra protocol transactions."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"decision",children:"Decision"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["We solve both challenges by defining that ST and PTs ",(0,i.jsx)(n.strong,{children:"shall use the same"})," ",(0,i.jsx)(n.code,{children:"MintingPolicyScript"})," and thus have same ",(0,i.jsx)(n.code,{children:"CurrencySymbol"})]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"MintingPolicyScript"})," shall be parameterized by ",(0,i.jsx)(n.code,{children:"TxOutRef"})," to yield a unique ",(0,i.jsx)(n.code,{children:"CurrencySymbol"})," per Head\n(similar to the ",(0,i.jsx)(n.a,{href:"https://github.com/input-output-hk/plutus/tree/1efbb276ef1a10ca6961d0fd32e6141e9798bd11/plutus-use-cases/src/Plutus/Contracts/Currency.hs",children:(0,i.jsx)(n.code,{children:"OneShotCurrency"})})," example)"]}),"\n",(0,i.jsxs)(n.li,{children:["ST and one PT per participant are minted in the ",(0,i.jsx)(n.code,{children:"initTx"})]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"TokenName"})," of the ST can be any well-known ",(0,i.jsx)(n.code,{children:"ByteString"}),", e.g. ",(0,i.jsx)(n.code,{children:'"HydraHeadV1"'})]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"TokenName"})," of the PTs needs to be the ",(0,i.jsx)(n.code,{children:"PubKeyHash"})," of the respective participant"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"consequences",children:"Consequences"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Heads can be identified by looking for the ",(0,i.jsx)(n.code,{children:"ST"})," in ",(0,i.jsx)(n.code,{children:"init"}),", ",(0,i.jsx)(n.code,{children:"collectCom"}),", ",(0,i.jsx)(n.code,{children:"close"}),", ",(0,i.jsx)(n.code,{children:"contest"})," or ",(0,i.jsx)(n.code,{children:"fanout"})," transactions, or the ",(0,i.jsx)(n.code,{children:"PT"})," in ",(0,i.jsx)(n.code,{children:"commit"})," transactions. In both cases, the ",(0,i.jsx)(n.code,{children:"CurrencySymbol == HeadId"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Our scripts become simpler as we only need to check that ST/PT are paid forward, instead of needing to check datums"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The datum produced by ",(0,i.jsx)(n.code,{children:"commit"})," txs (and consumed by ",(0,i.jsx)(n.code,{children:"collectCom"}),") is ",(0,i.jsx)(n.code,{children:"Just SerializedTxOut"}),", which is simpler than also keeping the participant which committed in the datum (compare to full life-cycle of ",(0,i.jsx)(n.a,{href:"https://github.com/cardano-scaling/hydra/tree/0.3.0/docs/images/on-chain-full.jpg",children:"0.3.0"}),")."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"v_head"})," script validator does not need to be parameterized, which makes discovering new Heads (and also tracking them for metrics) easier as the address to watch for is common to all Heads (of the same ",(0,i.jsx)(n.code,{children:"v_head"})," version)."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"v_head"})," script (path) for the abort life-cycle can be implemented already much safer by checking that all PTs are burned on the ",(0,i.jsx)(n.code,{children:"abort"})," transaction (counting inputs in abort life-cycle of ",(0,i.jsx)(n.a,{href:"https://github.com/cardano-scaling/hydra/tree/0.3.0/docs/images/on-chain-abort.jpg",children:"0.3.0"}),")."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Updated diagrams for the ",(0,i.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(20497).A+"",children:"full"})," and ",(0,i.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(79082).A+"",children:"abort"})," on-chain life-cycles of a Hydra Head."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"follow-up-questions",children:"Follow-up questions"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["What value does the ",(0,i.jsx)(n.code,{children:"ST"})," actually add? We could always look for the ",(0,i.jsx)(n.code,{children:"PT"})," to identify a Head and contract continuity would already be achieved by the ",(0,i.jsx)(n.code,{children:"PT"}),"s!"]}),"\n",(0,i.jsxs)(n.li,{children:["In discussions it turned out to be not clear where the Head's ",(0,i.jsx)(n.code,{children:"CurrencySymbol"})," is coming from, and consequently how to identify that an ",(0,i.jsx)(n.code,{children:"ST"})," is indeed an ",(0,i.jsx)(n.code,{children:"ST"}),"?"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},79082:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/files/on-chain-abort-c3483946d3116662c5cabfd67e3dde4e.jpg"},20497:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/files/on-chain-full-eea3dda97376810a7bfac1848a11a84a.jpg"},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>d});var s=t(96540);const i={},c=s.createContext(i);function a(e){const n=s.useContext(c);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(c.Provider,{value:n},e.children)}},2944:e=>{e.exports=JSON.parse('{"permalink":"/head-protocol/unstable/adr/14","source":"@site/adr/2022-02-14_014-hydra-script-tokens.md","title":"14. Token usage in Hydra Scripts\\n","description":"Status","date":"2022-02-14T00:00:00.000Z","tags":[{"inline":true,"label":"Accepted","permalink":"/head-protocol/unstable/adr/tags/accepted"}],"readingTime":2.5,"hasTruncateMarker":false,"authors":[],"frontMatter":{"slug":"14","title":"14. Token usage in Hydra Scripts\\n","authors":[],"tags":["Accepted"]},"unlisted":false,"prevItem":{"title":"13. Plutus Contracts Testing Strategy\\n","permalink":"/head-protocol/unstable/adr/13"},"nextItem":{"title":"15. Configuration Through an Admin API\\n","permalink":"/head-protocol/unstable/adr/15"}}')}}]);