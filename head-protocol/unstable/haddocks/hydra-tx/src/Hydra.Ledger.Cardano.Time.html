<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Module containing time conversion functions. These functions are assuming</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- that there is never going to be a different slot or epoch length and project</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- a slot/time accordingly.</span><span>
</span><span id="line-4"></span><span class="hs-comment">--</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- See Hydra.Chain.Direct.TimeHandle for an alternative that uses the</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- cardano-node provided 'EraSummary' to do &quot;correct&quot; translation on time.</span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hydra.Ledger.Cardano.Time</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Prelude</span></span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Slotting.Slot</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SlotNo</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Slotting.Time</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">RelativeTime</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SlotLength</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SystemStart</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getSlotLength</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getSystemStart</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toRelativeTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-comment">-- | Convert a 'SlotNo' to a 'UTCTime' using given 'SystemStart' and</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- 'SlotLength'. This assumes the slot length never changes!</span><span>
</span><span id="line-16"></span><span class="annot"><a href="Hydra.Ledger.Cardano.Time.html#slotNoToUTCTime"><span class="hs-identifier hs-type">slotNoToUTCTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SystemStart</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotLength</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/cz9ly62f92wivwp9aah4py51j2fnx6kf-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.UTCTime.html#UTCTime"><span class="hs-identifier hs-type">UTCTime</span></a></span><span>
</span><span id="line-17"></span><span id="slotNoToUTCTime"><span class="annot"><span class="annottext">slotNoToUTCTime :: SystemStart -&gt; SlotLength -&gt; SlotNo -&gt; UTCTime
</span><a href="Hydra.Ledger.Cardano.Time.html#slotNoToUTCTime"><span class="hs-identifier hs-var hs-var">slotNoToUTCTime</span></a></span></span><span> </span><span id="local-6989586621679431754"><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621679431754"><span class="hs-identifier hs-var">systemStart</span></a></span></span><span> </span><span id="local-6989586621679431755"><span class="annot"><span class="annottext">SlotLength
</span><a href="#local-6989586621679431755"><span class="hs-identifier hs-var">slotLength</span></a></span></span><span> </span><span id="local-6989586621679431756"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679431756"><span class="hs-identifier hs-var">slotNo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621679431757"><span class="hs-identifier hs-var">numberOfSlots</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; NominalDiffTime -&gt; NominalDiffTime
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/cz9ly62f92wivwp9aah4py51j2fnx6kf-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621679431759"><span class="hs-identifier hs-var">slotDuration</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; UTCTime -&gt; UTCTime
</span><a href="file:///nix/store/cz9ly62f92wivwp9aah4py51j2fnx6kf-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.UTCDiff.html#addUTCTime"><span class="hs-operator hs-var">`addUTCTime`</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679431761"><span class="hs-identifier hs-var">startTime</span></a></span><span>
</span><span id="line-19"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-20"></span><span>  </span><span id="local-6989586621679431761"><span class="annot"><span class="annottext">startTime :: UTCTime
</span><a href="#local-6989586621679431761"><span class="hs-identifier hs-var hs-var">startTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SystemStart -&gt; UTCTime
</span><span class="hs-identifier hs-var">getSystemStart</span></span><span> </span><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621679431754"><span class="hs-identifier hs-var">systemStart</span></a></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>  </span><span id="local-6989586621679431759"><span class="annot"><span class="annottext">slotDuration :: NominalDiffTime
</span><a href="#local-6989586621679431759"><span class="hs-identifier hs-var hs-var">slotDuration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotLength -&gt; NominalDiffTime
</span><span class="hs-identifier hs-var">getSlotLength</span></span><span> </span><span class="annot"><span class="annottext">SlotLength
</span><a href="#local-6989586621679431755"><span class="hs-identifier hs-var">slotLength</span></a></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span>  </span><span id="local-6989586621679431757"><span class="annot"><span class="annottext">numberOfSlots :: NominalDiffTime
</span><a href="#local-6989586621679431757"><span class="hs-identifier hs-var hs-var">numberOfSlots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; NominalDiffTime
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/cz9ly62f92wivwp9aah4py51j2fnx6kf-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; NominalDiffTime) -&gt; Word64 -&gt; NominalDiffTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/cz9ly62f92wivwp9aah4py51j2fnx6kf-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; Word64
</span><span class="hs-identifier hs-var">unSlotNo</span></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679431756"><span class="hs-identifier hs-var">slotNo</span></a></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-comment">-- | Convert a 'UTCTime' to a 'SlotNo' using given 'SystemStart' and</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- 'SlotLength'. This assumes the slot length never changes! Also if the UTCTime</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- is before the systemStart it will truncate to slot 0.</span><span>
</span><span id="line-29"></span><span class="annot"><a href="Hydra.Ledger.Cardano.Time.html#slotNoFromUTCTime"><span class="hs-identifier hs-type">slotNoFromUTCTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SystemStart</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotLength</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/cz9ly62f92wivwp9aah4py51j2fnx6kf-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.UTCTime.html#UTCTime"><span class="hs-identifier hs-type">UTCTime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-30"></span><span id="slotNoFromUTCTime"><span class="annot"><span class="annottext">slotNoFromUTCTime :: SystemStart -&gt; SlotLength -&gt; UTCTime -&gt; SlotNo
</span><a href="Hydra.Ledger.Cardano.Time.html#slotNoFromUTCTime"><span class="hs-identifier hs-var hs-var">slotNoFromUTCTime</span></a></span></span><span> </span><span id="local-6989586621679431764"><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621679431764"><span class="hs-identifier hs-var">systemStart</span></a></span></span><span> </span><span id="local-6989586621679431765"><span class="annot"><span class="annottext">SlotLength
</span><a href="#local-6989586621679431765"><span class="hs-identifier hs-var">slotLength</span></a></span></span><span> </span><span id="local-6989586621679431766"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679431766"><span class="hs-identifier hs-var">utcTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><span class="annottext">Word64 -&gt; SlotNo
</span><span class="hs-identifier hs-var">SlotNo</span></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; SlotNo) -&gt; Word64 -&gt; SlotNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/cz9ly62f92wivwp9aah4py51j2fnx6kf-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; Word64
forall b. Integral b =&gt; NominalDiffTime -&gt; b
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><a href="file:///nix/store/cz9ly62f92wivwp9aah4py51j2fnx6kf-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Real.html#truncate"><span class="hs-identifier hs-var">truncate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621679431768"><span class="hs-identifier hs-var">relativeTime</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; NominalDiffTime -&gt; NominalDiffTime
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/cz9ly62f92wivwp9aah4py51j2fnx6kf-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Real.html#%2F"><span class="hs-operator hs-var">/</span></a></span><span> </span><span class="annot"><span class="annottext">SlotLength -&gt; NominalDiffTime
</span><span class="hs-identifier hs-var">getSlotLength</span></span><span> </span><span class="annot"><span class="annottext">SlotLength
</span><a href="#local-6989586621679431765"><span class="hs-identifier hs-var">slotLength</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RelativeTime</span></span><span> </span><span id="local-6989586621679431768"><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621679431768"><span class="hs-identifier hs-var">relativeTime</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><span class="annottext">SystemStart -&gt; UTCTime -&gt; RelativeTime
</span><span class="hs-identifier hs-var">toRelativeTime</span></span><span> </span><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621679431764"><span class="hs-identifier hs-var">systemStart</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679431766"><span class="hs-identifier hs-var">utcTime</span></a></span><span>
</span><span id="line-35"></span></pre></body></html>